---
title: ""
author: "Alexssandro da Silva Oliveira"
date: "`r format(Sys.Date())`"
lang: pt
---

<br>

::: {style="border-top: 2px solid #003366;"}
:::

<br>



```{r setup, include=FALSE}
# Define opções padrão para todos os chunks de código no R Markdown
knitr::opts_chunk$set(
  echo = TRUE,         # Oculta o código nos resultados finais do documento
  warning = FALSE,     # Suprime mensagens de aviso (warnings)
  message = FALSE,     # Suprime mensagens informativas (como as de carregamento de pacotes)
  fig.width = 10,      # Define a largura padrão das figuras (em polegadas)
  fig.height = 6,      # Define a altura padrão das figuras (em polegadas)
  fig.align = 'center'
)

```



## Pacotes Necessários

::: {style="text-align: justify"}

Nesta seção, carregamos todas as bibliotecas utilizadas neste projeto. A verificação é realizada de forma automática e, posteriormente, as bibliotecas necessárias são carregadas para uso.

Para a elaboração deste estudo, empregaremos a linguagem de programação [**R**](http://www.R-project.org/), voltada para a manipulação, análise e visualização de dados, bem como o software livre de ambiente de desenvolvimento integrado [**RStudio**](https://posit.co/download/rstudio-desktop/).


```{r}
#| label: setup-plots
#| code-summary: "Carregando bibliotecas"
# Carregar pacotes necessários

# Este script verifica se os pacotes estão instalados. Se não (!require), instala e carrega.
# O argumento 'quiet = TRUE' remove as mensagens de download e instalação.

# ------------------------------------------------------------------------------
# A. Importação de Dados
# ------------------------------------------------------------------------------
if(!require("gsheet")) install.packages("gsheet", quiet = TRUE)
require("gsheet")     # Permite ler planilhas do Google Sheets diretamente pela URL

# ------------------------------------------------------------------------------
# B. Manipulação e Visualização de Dados
# ------------------------------------------------------------------------------
if(!require("tidyverse")) install.packages("tidyverse", quiet = TRUE)
require("tidyverse")  # Metapacote essencial: carrega dplyr, ggplot2, tidyr, etc.

if(!require("ggrepel")) install.packages("ggrepel", quiet = TRUE)
require("ggrepel")    # Evita que textos/rótulos se sobreponham nos gráficos

if(!require("corrplot")) install.packages("corrplot", quiet = TRUE)
require("corrplot")   # Ferramenta visual para criar matrizes de correlação

# ------------------------------------------------------------------------------
# C. Modelagem Estatística
# ------------------------------------------------------------------------------
if(!require("nlme")) install.packages("nlme", quiet = TRUE)
require("nlme")       # Ajuste de Modelos Lineares de Efeitos Mistos e GLS
                      # Fundamental para definir estruturas de correlação (AR1, CS)

if(!require("broom")) install.packages("broom", quiet = TRUE)
require("broom")      # Transforma resultados de modelos (summary) em tabelas limpas

# ------------------------------------------------------------------------------
# D. Apresentação de Resultados
# ------------------------------------------------------------------------------
if(!require("DT")) install.packages("DT", quiet = TRUE)
require("DT")         # Cria tabelas interativas e paginadas para relatórios HTML

if(!require("reactable")) install.packages("reactable", quiet = TRUE)
require("reactable")  # Outra opção excelente para tabelas interativas

```

:::

## Base Dados: Recuperação de Pacientes Pós-AVC (STROKE)

### Sobre os dados

::: {style="text-align: justify"}

O conjunto de dados abaixo contempla informações de um experimento para promover a recuperação de 24 pacientes que sofreram derrame. O objetivo é avaliar a eficácia de diferentes regimes de terapia ao longo de 8 semanas.

Os pacientes foram divididos em três grupos experimentais:

-   **Grupo A:** Uma nova intervenção de terapia ocupacional.
-   **Grupo B:** O programa existente de reabilitação de derrame.
-   **Grupo C:** O regime de cuidados usuais para pacientes com derrame.

<br>

```{r}
#| label: Importação da base de dados
#| code-summary: "Importação da base de dados"

# URL pública da planilha contendo os dados do experimento
url_stroke <- "https://docs.google.com/spreadsheets/d/1n394dzsNn1QITgigbHJ21uz6hi5TDCHs/edit?gid=712419062#gid=712419062"

# Leitura dos dados brutos 
bd_stroke <- gsheet::gsheet2tbl(url_stroke)

# Tabela Interativa dos dados Brutos
DT::datatable(
  bd_stroke,
  caption = htmltools::tags$caption(
    style = "caption-side: top; text-align: center; color:#40916c;",
    htmltools::strong("Tabela 1:  Dados Brutos de Recuperação de Pacientes Pós-AVC (formato largo)")
  ),
  class = "hover",
  options = list(
    pageLength = 8, searching = FALSE, lengthChange = FALSE, 
    info = FALSE, ordering = FALSE,
    language = list(
      paginate = list("previous" = "Anterior", "next" = "Próximo")
    )
  )
)

# Descritiva 
dplyr::glimpse(bd_stroke)
```

:::

<br>

### Reestruturação e Tratamento dos Dados

::: {style="text-align: justify"}
Para a modelagem longitudinal, o conjunto de dados é submetido a três fases cruciais de processamento e estruturação:

-   **Passo 1 - Leitura:** Importação da base de dados brutos para o ambiente R (visto anteriormente).
-   **Passo 2 - Reestruturação:** A base de dados, lida inicialmente no formato largo (Wide), deve ser transformada para o formato formato longo (long), onde cada linha representa uma única observação no tempo, ex: paciente na Semana 3. Esta reestruturação é obrigatória em análises de medidas repetidas para que o modelo possa identificar e ajustar a correlação intra-sujeito.
-   **Passo 3 - Criação de Variável:** Se necessário, deve ser realizada a criação da variável de tempo recentralizada, que é crucial para garantir que o intercepto do modelo estatístico ($\beta_0$) represente o valor basal (Semana 1 = Tempo 0).

<br>

```{r}
#| label: Reestruturação e Tratamento dos Dados
#| code-summary: "Reestruturação e Tratamento dos Dados"

# Reestruturação e Tratamento dos Dados

bd_stroke_long <- bd_stroke %>%
  
  # Renomeia as variáveis identificadoras para facilitar a interpretação no R.
  dplyr::rename(
    Sujeito = Subject,  # ID do paciente (define o nível de agrupamento/efeito aleatório)
    Grupo   = Group     # Fator fixo de interesse (Tratamento A vs B)
  ) %>%
  
  # Passo 2: Reestruturação de Dados (Wide -> Long), o R precisa que cada linha seja uma observação única no tempo.
  tidyr::pivot_longer(
    cols = week_1:week_8,    # Vetor de colunas que contêm as medidas repetidas
    names_to = "Semana",     # Nova variável categórica indicando o tempo
    values_to = "Valor"      # Nova variável contínua com a resposta (outcome)
  ) %>%
  
  # Passo 3: Engenharia de Variáveis (Feature Engineering)
  dplyr::mutate(
    # Necessário para tratar o tempo como covariável contínua (tendência linear/quadrática).
    Semana = as.numeric(stringr::str_remove(Semana, "week_")),
    
    # Centralização do Tempo, e crucial, Ao subtrair 1, transformamos a escala de [1, 8] para [0, 7], facilitando a interpretação clínica dos parâmetros do modelo.
    Semana_recentralizada = Semana - 1
  )

# Tabela Interativa dos dados reestruturados

# Gerar a tabela com estilo minimalista
DT::datatable(
  bd_stroke_long,  # <--- Objeto de dados do Stroke
  
  # Configuração da Legenda (Caption)
  caption = htmltools::tags$caption(
    style = "caption-side: top; text-align: center; color:#40916c;",
    htmltools::strong("Tabela 2:  Dados Longitudinais de Recuperação de Pacientes Pós-AVC (formato longo)")
  ),
  # Estilo CSS da tabela (apenas hover, sem bordas pesadas)
  class = "hover", 
  
  # Opções de funcionalidade e visual
  options = list(
    pageLength = 8,       # Mostra 8 linhas por página
    searching = FALSE,    # Remove a barra de busca
    
    # --- Visual Limpo ---
    lengthChange = FALSE, # Remove o menu "Mostrar X entradas"
    info = FALSE,         # Remove o rodapé "Mostrando 1 a X de Y"
    ordering = FALSE,     # Remove as setas de ordenação nas colunas
    
    # Tradução dos botões
    language = list(
      paginate = list("previous" = "Anterior", "next" = "Próximo"),
      emptyTable = "Não há dados disponíveis na tabela",
      zeroRecords = "Nenhum registro correspondente encontrado"
    )
  )
)

# Descritiva 
dplyr::glimpse(bd_stroke_long)

```

:::


<br>

::: {style="border-top: 2px solid #003366;"}
:::

<br>
